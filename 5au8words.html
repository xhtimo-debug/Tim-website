<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Unit 8 At Christmas - Tim's App</title>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(to bottom, #FEF2F2, #FFF7ED); /* æ¸å˜èƒŒæ™¯ */
            color: #1F2937;
            overflow: hidden;
            touch-action: manipulation;
            user-select: none;
            -webkit-user-select: none;
            height: 100vh; /* å¼ºåˆ¶å…¨å±é«˜åº¦ */
        }

        /* 3D ç¿»è½¬æ•ˆæœ */
        .card-container {
            perspective: 1000px;
            width: 100%;
            height: 100%; /* å æ»¡çˆ¶å®¹å™¨ */
            position: relative;
        }
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s cubic-bezier(0.4, 0.0, 0.2, 1); /* æ›´å¹³æ»‘çš„åŠ¨ç”» */
            transform-style: preserve-3d;
        }
        .card-inner.is-flipped {
            transform: rotateY(180deg);
        }
        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 1.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            background-color: white; /* é»˜è®¤ç™½åº• */
        }
        .card-front {
            border: 2px solid #FECACA; /* red-200 */
        }
        .card-back {
            background: linear-gradient(135deg, #DC2626, #B91C1C); /* æ›´æœ‰è´¨æ„Ÿçš„çº¢ */
            color: white;
            transform: rotateY(180deg);
            border: 4px solid #86EFAC; /* green-300 */
        }

        /* åŠ¨ç”»ç±» */
        .animate-bounce-slow { animation: bounce 3s infinite; }
        .animate-fade-in { animation: fadeIn 0.5s ease-out; }
        .hidden { display: none !important; }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(-5%); }
            50% { transform: translateY(5%); }
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* æ°´å° */
        .watermark {
            position: fixed;
            bottom: 15px;
            right: 15px;
            color: rgba(0, 0, 0, 0.15); /* ç¨å¾®æ·¡ä¸€ç‚¹ */
            font-size: 12px;
            font-weight: 700;
            pointer-events: none;
            font-family: 'Courier New', Courier, monospace;
            z-index: 50;
            letter-spacing: 1px;
        }

        /* æ»šåŠ¨æ¡ */
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        
        /* é›ªèŠ± */
        .snowflake {
            position: fixed;
            top: -10px;
            color: #A7F3D0; /* green-200 */
            font-size: 1.2em;
            text-shadow: 0 0 2px rgba(255,255,255,0.8);
            z-index: 0;
            pointer-events: none;
            animation-name: snowflakes-fall, snowflakes-shake;
            animation-duration: 10s, 3s;
            animation-timing-function: linear, ease-in-out;
            animation-iteration-count: infinite, infinite;
        }
        @keyframes snowflakes-fall { 0% { top: -10%; } 100% { top: 100%; } }
        @keyframes snowflakes-shake { 0% { transform: translateX(0px); } 50% { transform: translateX(80px); } 100% { transform: translateX(0px); } }
        
        /* ç¦ç”¨çŠ¶æ€ */
        .btn-disabled { opacity: 0.3; cursor: not-allowed; pointer-events: none; transform: none !important; box-shadow: none !important; }
    </style>
</head>
<body>

    <!-- æ°´å° -->
    <div class="watermark">Created by Tim</div>

    <!-- é›ªèŠ±è£…é¥° -->
    <div class="snowflake" style="left: 10%; animation-delay: 0s, 0s">â…</div>
    <div class="snowflake" style="left: 20%; animation-delay: 2s, 1s; font-size: 0.8em">â†</div>
    <div class="snowflake" style="left: 30%; animation-delay: 4s, 2s">â…</div>
    <div class="snowflake" style="left: 50%; animation-delay: 2s, 1s">â†</div>
    <div class="snowflake" style="left: 70%; animation-delay: 5s, 0s; font-size: 1.5em">â…</div>
    <div class="snowflake" style="left: 80%; animation-delay: 1s, 2s">â†</div>
    <div class="snowflake" style="left: 90%; animation-delay: 3s, 1.5s">â…</div>

    <!-- 1. å¯åŠ¨ç•Œé¢ -->
    <div id="start-screen" class="fixed inset-0 z-20 flex flex-col items-center justify-center p-6 h-full">
        <!-- èƒŒæ™¯è£…é¥°åœ† -->
        <div class="absolute top-1/4 left-1/2 -translate-x-1/2 w-64 h-64 bg-red-100 rounded-full blur-3xl opacity-50 pointer-events-none"></div>

        <div class="relative w-full max-w-sm flex flex-col items-center animate-fade-in space-y-8">
            
            <!-- LogoåŒºåŸŸ -->
            <div class="relative">
                <div class="absolute inset-0 bg-green-100 rounded-full blur opacity-60 animate-pulse"></div>
                <div class="relative bg-white p-6 rounded-3xl shadow-xl border-4 border-red-50">
                    <svg class="w-24 h-24 text-green-600 animate-bounce-slow" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 2l8 8h-4v10H8V10H4l8-8z"/><rect x="10" y="20" width="4" height="4"/>
                    </svg>
                </div>
                <!-- è£…é¥°æ˜Ÿæ˜Ÿ -->
                <svg class="absolute -top-2 -right-2 w-8 h-8 text-yellow-400 animate-pulse" fill="currentColor" viewBox="0 0 24 24"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
            </div>

            <!-- æ ‡é¢˜åŒºåŸŸ -->
            <div class="text-center space-y-2">
                <span class="inline-block px-3 py-1 bg-red-100 text-red-600 rounded-full text-xs font-bold tracking-wider uppercase">Grade 5 English</span>
                <h1 class="text-5xl font-black text-red-600 tracking-tight drop-shadow-sm">Unit 8</h1>
                <h2 class="text-2xl font-bold text-gray-700">At Christmas</h2>
            </div>

            <!-- æŒ‰é’®åŒºåŸŸ -->
            <div class="w-full pt-4">
                <button onclick="app.startGame()" class="group relative w-full py-5 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-2xl shadow-lg hover:shadow-2xl hover:scale-[1.02] active:scale-95 transition-all duration-200 overflow-hidden">
                    <div class="absolute inset-0 bg-white/20 group-hover:translate-x-full transition-transform duration-500 -skew-x-12 -translate-x-full"></div>
                    <div class="flex items-center justify-center space-x-3">
                        <span class="bg-white/20 p-1.5 rounded-full">
                            <svg class="w-6 h-6 fill-current" viewBox="0 0 24 24"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                        </span>
                        <span class="text-xl font-bold tracking-wide">Start Challenge</span>
                    </div>
                </button>
                <p class="text-center text-gray-400 text-sm mt-4">Review vocabulary with Tim!</p>
            </div>
        </div>
    </div>

    <!-- 2. æ¸¸æˆä¸»ç•Œé¢ -->
    <div id="game-screen" class="hidden fixed inset-0 z-20 flex flex-col items-center w-full h-full bg-white/50 backdrop-blur-sm">
        <!-- Header -->
        <header class="w-full bg-white/80 backdrop-blur-md border-b border-red-100 p-4 flex justify-between items-center z-30 sticky top-0">
            <div class="flex items-center space-x-2 text-red-600">
                <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 2l8 8h-4v10H8V10H4l8-8z"/></svg>
                <h1 class="text-lg font-bold">Unit 8</h1>
            </div>
            <div class="flex items-center space-x-3">
                <div id="progress-text" class="text-sm font-medium text-gray-500">1 / 10</div>
                <div class="bg-yellow-100 px-3 py-1 rounded-full flex items-center space-x-1 border border-yellow-200">
                    <svg class="w-4 h-4 text-yellow-500 fill-current" viewBox="0 0 24 24"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                    <span id="score-text" class="font-bold text-yellow-700">0</span>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-1 w-full max-w-md p-6 flex flex-col items-center justify-center animate-fade-in relative" style="height: calc(100% - 70px);">
            
            <!-- è¿›åº¦æ¡ -->
            <div class="absolute top-0 left-0 w-full h-1 bg-gray-100">
                <div id="progress-bar" class="bg-red-500 h-full transition-all duration-300" style="width: 0%"></div>
            </div>

            <!-- å¡ç‰‡å®¹å™¨ -->
            <div class="w-full flex-1 max-h-[500px] min-h-[300px] mb-8 mt-4 perspective-1000">
                <div id="card-container" class="card-container cursor-pointer" onclick="app.handleCardClick()">
                    <div id="card-inner" class="card-inner">
                        <!-- æ­£é¢ -->
                        <div class="card-face card-front">
                            <div class="flex-1 flex flex-col items-center justify-center w-full">
                                <span id="card-emoji" class="text-8xl mb-6 filter drop-shadow-md transform transition-transform hover:scale-110">ğŸ„</span>
                                <h3 id="card-zh" class="text-4xl font-bold text-gray-800 tracking-wider mb-2">åœ£è¯èŠ‚</h3>
                                <span id="card-type" class="inline-block px-2 py-1 bg-gray-100 text-gray-500 text-xs rounded-md font-mono mb-4">n.</span>
                            </div>
                            <div class="pb-8 w-full flex justify-center">
                                <p class="text-red-500 text-sm font-bold bg-red-50 px-6 py-2 rounded-full animate-pulse">
                                    ğŸ‘† ç‚¹æˆ‘ç¿»è½¬
                                </p>
                            </div>
                        </div>
                        <!-- èƒŒé¢ -->
                        <div class="card-face card-back relative overflow-hidden">
                             <!-- è£…é¥°èƒŒæ™¯ -->
                             <div class="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2 blur-2xl pointer-events-none"></div>
                             
                             <!-- æ’­æ”¾æŒ‰é’® -->
                             <button onclick="event.stopPropagation(); app.speakCurrent();" class="absolute top-4 right-4 p-4 rounded-full text-white/80 hover:text-white hover:bg-white/10 transition z-20">
                                <svg class="w-8 h-8" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" /></svg>
                             </button>

                            <div class="flex-1 flex flex-col items-center justify-center w-full px-6">
                                <h3 id="card-en" class="text-4xl font-extrabold mb-6 text-yellow-300 tracking-tight break-words w-full leading-tight">Christmas</h3>
                                <div class="w-12 h-1 bg-white/30 rounded-full mb-6"></div>
                                <div class="bg-black/20 p-6 rounded-2xl w-full border border-white/10 backdrop-blur-sm">
                                    <p id="card-sentence" class="text-lg leading-relaxed font-medium text-white/90">"Christmas is coming!"</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æŒ‰é’®åŒº -->
            <div class="w-full grid grid-cols-4 gap-3 mt-auto mb-2">
                <button id="btn-prev" onclick="app.prevCard()" class="col-span-1 py-4 rounded-2xl bg-white text-gray-400 font-bold shadow-sm border border-gray-200 hover:bg-gray-50 hover:text-gray-600 active:scale-95 transition flex items-center justify-center">
                    <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18" /></svg>
                </button>

                <button id="btn-skip" onclick="app.nextCard()" class="col-span-1 py-4 rounded-2xl bg-white text-gray-600 font-bold shadow-sm border border-gray-200 hover:bg-gray-50 active:scale-95 transition flex flex-col items-center justify-center leading-none">
                    <span id="btn-skip-text" class="text-sm">è·³è¿‡</span>
                </button>
                
                <button id="btn-learn" onclick="app.markLearned()" class="col-span-2 py-4 rounded-2xl bg-green-500 text-white font-bold shadow-lg shadow-green-200 hover:bg-green-600 active:scale-95 transition flex items-center justify-center space-x-2">
                    <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" /></svg>
                    <span id="btn-learn-text">æˆ‘è®°ä½äº†</span>
                </button>
            </div>
        </main>
    </div>

    <!-- 3. ç»“ç®—ç•Œé¢ (ä¼˜åŒ–ï¼šåˆ†ç±»æ˜¾ç¤º) -->
    <div id="result-screen" class="hidden fixed inset-0 z-20 flex flex-col items-center p-6 h-full bg-white/90 backdrop-blur-md">
        <div class="w-full max-w-md h-full flex flex-col animate-fade-in">
            <!-- å¤´éƒ¨ -->
            <div class="text-center mb-4 pt-4">
                <div class="inline-block p-4 bg-red-50 rounded-full mb-4 shadow-sm">
                    <svg class="w-12 h-12 text-red-500 animate-bounce" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M20 12v10H4V12M22 7H2v5h20V7zM12 22V7M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7zM12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"/></svg>
                </div>
                <h2 class="text-3xl font-extrabold text-gray-800">Great Job!</h2>
                <p class="text-gray-500">Unit 8 Review Complete</p>
            </div>

            <!-- åˆ†æ•°å¡ -->
            <div class="grid grid-cols-2 gap-4 mb-4">
                <div class="bg-green-50 p-4 rounded-2xl border border-green-100 text-center">
                    <p class="text-xs text-green-600 font-bold uppercase tracking-wider mb-1">Total XP</p>
                    <p id="final-score" class="text-3xl font-black text-green-700">0</p>
                </div>
                <div class="bg-blue-50 p-4 rounded-2xl border border-blue-100 text-center">
                    <p class="text-xs text-blue-600 font-bold uppercase tracking-wider mb-1">Mastered</p>
                    <p id="final-learned" class="text-3xl font-black text-blue-700">0</p>
                </div>
            </div>

            <!-- åˆ—è¡¨å®¹å™¨ (åˆ†ä¸º Mastered å’Œ Review) -->
            <div class="flex-1 overflow-hidden flex flex-col gap-2 mb-4">
                <!-- Mastered List -->
                <div class="flex-1 bg-white rounded-xl border border-green-200 overflow-hidden flex flex-col shadow-sm">
                    <div class="p-2 bg-green-50 border-b border-green-100 font-bold text-green-700 text-xs uppercase flex items-center">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        Mastered (å·²æŒæ¡)
                    </div>
                    <div id="mastered-list" class="flex-1 overflow-y-auto custom-scrollbar p-2 space-y-2">
                        <!-- JS å¡«å…… -->
                    </div>
                </div>

                <!-- Review List -->
                <div class="flex-1 bg-white rounded-xl border border-orange-200 overflow-hidden flex flex-col shadow-sm">
                    <div class="p-2 bg-orange-50 border-b border-orange-100 font-bold text-orange-700 text-xs uppercase flex items-center">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        Review (éœ€å¤ä¹ )
                    </div>
                    <div id="review-list" class="flex-1 overflow-y-auto custom-scrollbar p-2 space-y-2">
                        <!-- JS å¡«å…… -->
                    </div>
                </div>
            </div>

            <button onclick="app.restartGame()" class="w-full py-4 rounded-2xl bg-red-600 text-white font-bold text-lg shadow-lg hover:bg-red-700 active:scale-95 transition flex items-center justify-center space-x-2 flex-shrink-0">
                <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>
                <span>Play Again</span>
            </button>
        </div>
    </div>

    <script>
        // æ•°æ®
        const VOCABULARY = [
            { id: 1, en: "Christmas", zh: "åœ£è¯èŠ‚", type: "n.", emoji: "ğŸ„", sentence: "We always have a lot of fun at Christmas." },
            { id: 2, en: "buy", zh: "ä¹°", type: "v.", emoji: "ğŸ›ï¸", sentence: "First, we buy presents for our family." },
            { id: 3, en: "present", zh: "ç¤¼ç‰©", type: "n.", emoji: "ğŸ", sentence: "We open our presents on Christmas Day." },
            { id: 4, en: "Christmas tree", zh: "åœ£è¯æ ‘", type: "n.", emoji: "ğŸ„", sentence: "We buy a Christmas tree." },
            { id: 5, en: "Father Christmas", zh: "åœ£è¯è€äºº", type: "n.", emoji: "ğŸ…", sentence: "We go to see Father Christmas." },
            { id: 6, en: "next", zh: "æ¥ç€ï¼Œç„¶å", type: "adv.", emoji: "ğŸ‘‰", sentence: "Next, we put pretty things on the tree." },
            { id: 7, en: "put", zh: "æ”¾", type: "v.", emoji: "ğŸ‘", sentence: "We put a stocking on our beds." },
            { id: 8, en: "pretty", zh: "æ¼‚äº®çš„", type: "adj.", emoji: "âœ¨", sentence: "The Christmas tree looks pretty." },
            { id: 9, en: "thing", zh: "ç‰©å“ï¼Œä¸œè¥¿", type: "n.", emoji: "ğŸ§¸", sentence: "We put pretty things on the Christmas tree." },
            { id: 10, en: "look", zh: "çœ‹èµ·æ¥", type: "v.", emoji: "ğŸ‘€", sentence: "It looks great!" },
            { id: 11, en: "Christmas Eve", zh: "åœ£è¯å¤œ", type: "n.", emoji: "ğŸŒ™", sentence: "Then, Christmas Eve comes." },
            { id: 12, en: "stocking", zh: "é•¿ç­’è¢œ", type: "n.", emoji: "ğŸ§¦", sentence: "We put a stocking on our beds." },
            { id: 13, en: "wait for", zh: "ç­‰å€™ï¼Œç­‰å¾…", type: "v. phr.", emoji: "â³", sentence: "We wait for presents." },
            { id: 14, en: "finally", zh: "æœ€å", type: "adv.", emoji: "ğŸ", sentence: "Finally, it is Christmas Day!" },
            { id: 15, en: "Christmas Day", zh: "åœ£è¯èŠ‚(å½“å¤©)", type: "n.", emoji: "ğŸ‰", sentence: "We have a big lunch on Christmas Day." },
            { id: 16, en: "early", zh: "æ—©æ—©åœ°", type: "adv.", emoji: "ğŸŒ…", sentence: "We wake up early." },
            { id: 17, en: "turkey", zh: "ç«é¸¡", type: "n.", emoji: "ğŸ¦ƒ", sentence: "We eat a turkey." },
            { id: 18, en: "pudding", zh: "å¸ƒä¸", type: "n.", emoji: "ğŸ®", sentence: "We eat Christmas pudding." },
            { id: 19, en: "all", zh: "å…¨éƒ½", type: "adv.", emoji: "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦", sentence: "We all have a good time!" },
            { id: 20, en: "have a good time", zh: "è¿‡å¾—æ„‰å¿«", type: "v. phr.", emoji: "ğŸ¥³", sentence: "We all have a good time!" },
            { id: 21, en: "card", zh: "å¡ç‰‡", type: "n.", emoji: "ğŸ’Œ", sentence: "Here is a Christmas card for you." },
            { id: 22, en: "children", zh: "å­©å­", type: "n.", emoji: "ğŸ‘¶", sentence: "The children are happy." },
            { id: 23, en: "message", zh: "ä¿¡æ¯", type: "n.", emoji: "ğŸ“", sentence: "Write your message on the card." },
            { id: 24, en: "Merry Christmas!", zh: "åœ£è¯å¿«ä¹!", type: "phrase", emoji: "ğŸ‰", sentence: "Merry Christmas!" },
            { id: 25, en: "song", zh: "æ­Œæ›²", type: "n.", emoji: "ğŸµ", sentence: "They sing Christmas songs." },
            { id: 26, en: "What's wrong with ...?", zh: "â€¦â€¦æ€ä¹ˆäº†ï¼Ÿ", type: "phrase", emoji: "â“", sentence: "What's wrong with him?" },
            { id: 27, en: "him", zh: "ä»–(å®¾æ ¼)", type: "pron.", emoji: "ğŸ‘¦", sentence: "What's wrong with him?" },
            { id: 28, en: "us", zh: "æˆ‘ä»¬(å®¾æ ¼)", type: "pron.", emoji: "ğŸ‘¥", sentence: "People eat us on Christmas Day!" },
            { id: 29, en: "letter", zh: "ä¿¡", type: "n.", emoji: "âœ‰ï¸", sentence: "I sometimes write him a letter." },
            { id: 30, en: "storybook", zh: "æ•…äº‹ä¹¦", type: "n.", emoji: "ğŸ“–", sentence: "I read a storybook after dinner." },
            { id: 31, en: "after", zh: "åœ¨â€¦â€¦ä»¥å", type: "prep.", emoji: "ğŸ•’", sentence: "I read a storybook after dinner." }
        ];

        // é€»è¾‘æ§åˆ¶
        const app = {
            currentIndex: 0,
            score: 0,
            learnedCount: 0,
            isFlipped: false,
            isTransitioning: false,
            audioCtx: null,
            voices: [],
            learnedWords: [], // æ–°å¢ï¼šè®°å½•æŒæ¡çš„å•è¯ID

            init: function() {
                // è§£å†³å®‰å“å£°éŸ³é—®é¢˜ï¼šåœ¨ç¬¬ä¸€æ¬¡ç”¨æˆ·äº¤äº’æ—¶åˆå§‹åŒ– AudioContext å’Œ è¯­éŸ³åˆ—è¡¨
                document.body.addEventListener('click', () => {
                    this.initAudioContext();
                    this.ensureVoicesLoaded();
                }, { once: true });
                
                // å°è¯•é¢„åŠ è½½ voices
                this.ensureVoicesLoaded();
            },

            initAudioContext: function() {
                if (!this.audioCtx) {
                    const AudioContext = window.AudioContext || window.webkitAudioContext;
                    if (AudioContext) {
                        this.audioCtx = new AudioContext();
                        // æ’­æ”¾ä¸€ä¸ªæ— å£°ç‰‡æ®µè§£é” iOS/Android éŸ³é¢‘
                        const buffer = this.audioCtx.createBuffer(1, 1, 22050);
                        const source = this.audioCtx.createBufferSource();
                        source.buffer = buffer;
                        source.connect(this.audioCtx.destination);
                        source.start(0);
                    }
                } else if (this.audioCtx.state === 'suspended') {
                    this.audioCtx.resume();
                }
            },

            ensureVoicesLoaded: function() {
                if ('speechSynthesis' in window) {
                    const load = () => {
                        this.voices = window.speechSynthesis.getVoices();
                    };
                    load();
                    if (window.speechSynthesis.onvoiceschanged !== undefined) {
                        window.speechSynthesis.onvoiceschanged = load;
                    }
                }
            },

            playSound: function(type) {
                this.initAudioContext(); // ç¡®ä¿ AudioContext å·²åˆå§‹åŒ–
                if (!this.audioCtx) return;

                try {
                    const ctx = this.audioCtx;
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.connect(gain);
                    gain.connect(ctx.destination);
                    const now = ctx.currentTime;

                    if (type === 'pop') {
                        osc.type = 'sine';
                        osc.frequency.setValueAtTime(400, now);
                        osc.frequency.exponentialRampToValueAtTime(600, now + 0.1);
                        gain.gain.setValueAtTime(0.1, now);
                        gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                        osc.start(now);
                        osc.stop(now + 0.1);
                    } else if (type === 'win') {
                        const notes = [523.25, 659.25, 783.99, 1046.50];
                        notes.forEach((freq, i) => {
                            const oscN = ctx.createOscillator();
                            const gainN = ctx.createGain();
                            oscN.connect(gainN);
                            gainN.connect(ctx.destination);
                            oscN.type = 'triangle';
                            oscN.frequency.value = freq;
                            const startTime = now + i * 0.1;
                            gainN.gain.setValueAtTime(0, startTime);
                            gainN.gain.linearRampToValueAtTime(0.1, startTime + 0.05);
                            gainN.gain.exponentialRampToValueAtTime(0.01, startTime + 0.5);
                            oscN.start(startTime);
                            oscN.stop(startTime + 0.5);
                        });
                    }
                } catch(e) { console.error(e); }
            },

            speak: function(text) {
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.cancel();
                    
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'en-US';
                    
                    // å…³é”®ä¿®æ”¹ï¼šè°ƒæ•´å‚æ•°è®©å£°éŸ³æ›´å¹´è½»æ˜äº®
                    utterance.rate = 0.9; // ç¨æ…¢
                    utterance.pitch = 1.2; // æ˜¾è‘—æé«˜éŸ³è°ƒï¼Œè§£å†³â€œè€å¤´éŸ³â€é—®é¢˜

                    if (this.voices.length > 0) {
                        // å¼ºåˆ¶å¯»æ‰¾å¥³å£° (Android/Windows/iOS é€šç”¨ç­–ç•¥)
                        let bestVoice = this.voices.find(v => v.name.includes("Google US English"));
                        
                        if (!bestVoice) bestVoice = this.voices.find(v => v.name.includes("Female") && v.lang.startsWith("en"));
                        if (!bestVoice) bestVoice = this.voices.find(v => v.name.includes("Samantha"));
                        if (!bestVoice) bestVoice = this.voices.find(v => v.name.includes("Microsoft Zira"));
                        if (!bestVoice) bestVoice = this.voices.find(v => v.lang === 'en-US');
                        
                        if (bestVoice) utterance.voice = bestVoice;
                    }

                    utterance.onerror = (e) => {
                        console.error('Speech error:', e);
                        window.speechSynthesis.cancel();
                    };

                    window.speechSynthesis.speak(utterance);
                }
            },
            
            speakCurrent: function() {
                const card = VOCABULARY[this.currentIndex];
                this.speak(card.en);
            },

            startGame: function() {
                this.playSound('pop');
                // å¼ºåˆ¶è§¦å‘ä¸€æ¬¡è¯­éŸ³åŠ è½½ï¼Œè§£å†³å®‰å“é¦–æ¬¡æ— å£°é—®é¢˜
                this.ensureVoicesLoaded();
                
                document.getElementById('start-screen').classList.add('hidden');
                document.getElementById('game-screen').classList.remove('hidden');
                this.updateCard();
            },

            updateCard: function() {
                const card = VOCABULARY[this.currentIndex];
                document.getElementById('card-emoji').textContent = card.emoji;
                document.getElementById('card-zh').textContent = card.zh;
                document.getElementById('card-type').textContent = card.type;
                document.getElementById('card-en').textContent = card.en;
                document.getElementById('card-sentence').textContent = '"' + card.sentence + '"';
                
                // Reset flip
                this.isFlipped = false;
                document.getElementById('card-inner').classList.remove('is-flipped');

                // Update UI
                document.getElementById('score-text').textContent = this.score;
                document.getElementById('progress-text').textContent = `${this.currentIndex + 1} / ${VOCABULARY.length}`;
                document.getElementById('progress-bar').style.width = `${((this.currentIndex + 1) / VOCABULARY.length) * 100}%`; // è¿›åº¦æ¡ä¿®æ»¡
                
                // Button states
                const isLast = this.currentIndex === VOCABULARY.length - 1;
                document.getElementById('btn-skip-text').textContent = isLast ? "ç»“æŸ" : "è·³è¿‡";
                document.getElementById('btn-learn-text').textContent = isLast ? "å®Œæˆ (+10)" : "æˆ‘è®°ä½äº†";
                
                const prevBtn = document.getElementById('btn-prev');
                if (this.currentIndex === 0) prevBtn.classList.add('btn-disabled');
                else prevBtn.classList.remove('btn-disabled');
            },

            handleCardClick: function() {
                if(this.isTransitioning) return;
                if(!this.isFlipped) this.speakCurrent();
                this.isFlipped = !this.isFlipped;
                document.getElementById('card-inner').classList.toggle('is-flipped');
            },

            nextCard: function() {
                if(this.isTransitioning) return;
                this.playSound('pop');
                this.transition(() => {
                    if(this.currentIndex >= VOCABULARY.length - 1) {
                        this.showResult();
                    } else {
                        this.currentIndex++;
                        this.updateCard();
                    }
                });
            },

            prevCard: function() {
                if(this.isTransitioning || this.currentIndex === 0) return;
                this.playSound('pop');
                this.transition(() => {
                    this.currentIndex--;
                    this.updateCard();
                });
            },

            markLearned: function() {
                if(this.isTransitioning) return;
                this.score += 10;
                this.learnedCount++;
                this.learnedWords.push(VOCABULARY[this.currentIndex].id); // è®°å½•ID
                this.playSound('success'); // è¿™é‡Œå¤ç”¨ pop
                this.nextCard();
            },

            transition: function(callback) {
                this.isTransitioning = true;
                this.isFlipped = false;
                document.getElementById('card-inner').classList.remove('is-flipped');
                setTimeout(() => {
                    callback();
                    this.isTransitioning = false;
                }, 300);
            },

            showResult: function() {
                this.playSound('win');
                document.getElementById('game-screen').classList.add('hidden');
                document.getElementById('result-screen').classList.remove('hidden');
                document.getElementById('final-score').textContent = this.score;
                document.getElementById('final-learned').textContent = `${this.learnedCount}/${VOCABULARY.length}`;
                
                // æ¸²æŸ“å•è¯åˆ—è¡¨
                const masteredList = document.getElementById('mastered-list');
                const reviewList = document.getElementById('review-list');
                masteredList.innerHTML = '';
                reviewList.innerHTML = '';

                VOCABULARY.forEach(word => {
                    const div = document.createElement('div');
                    div.className = 'flex items-center p-2 bg-white rounded shadow-sm';
                    div.innerHTML = `
                        <span class="text-xl mr-3">${word.emoji}</span>
                        <div class="flex-1">
                            <div class="flex items-center justify-between">
                                <span class="font-bold text-gray-800 text-sm">${word.en}</span>
                                <span class="text-xs text-gray-400 italic">${word.type}</span>
                            </div>
                            <div class="text-xs text-gray-500">${word.zh}</div>
                        </div>
                        <button onclick="app.speak('${word.en}')" class="p-1.5 text-gray-400 hover:text-red-500 bg-gray-50 rounded-full ml-2">
                            <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" /></svg>
                        </button>
                    `;
                    
                    if (this.learnedWords.includes(word.id)) {
                        masteredList.appendChild(div);
                    } else {
                        reviewList.appendChild(div);
                    }
                });
                
                // å¦‚æœæŸä¸ªåˆ—è¡¨ä¸ºç©ºï¼Œæ˜¾ç¤ºæç¤º
                if (masteredList.children.length === 0) masteredList.innerHTML = '<div class="text-center text-gray-400 text-xs py-2">None yet</div>';
                if (reviewList.children.length === 0) reviewList.innerHTML = '<div class="text-center text-gray-400 text-xs py-2">All mastered!</div>';
            },

            restartGame: function() {
                this.currentIndex = 0;
                this.score = 0;
                this.learnedCount = 0;
                this.learnedWords = [];
                this.isFlipped = false;
                document.getElementById('result-screen').classList.add('hidden');
                document.getElementById('game-screen').classList.remove('hidden');
                this.updateCard();
            }
        };

        // åˆå§‹åŒ–
        app.init();
    </script>
</body>
</html>
