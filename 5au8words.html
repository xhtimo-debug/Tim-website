<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unit 8 At Christmas - å•è¯æ´¾å¯¹</title>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ React å’Œ ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- å¼•å…¥ Babel ç”¨äºè§£æ JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- è‡ªå®šä¹‰åŠ¨ç”»æ ·å¼ -->
    <style>
        .perspective-1000 { perspective: 1000px; }
        .transform-style-3d { 
            transform-style: preserve-3d; 
            -webkit-transform-style: preserve-3d;
        }
        .backface-hidden { 
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden; 
        }
        .my-rotate-y-180 { transform: rotateY(180deg); }
        
        .animate-bounce-slow { animation: bounce 3s infinite; }
        .animate-fade-in { animation: fadeIn 0.5s ease-out; }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(-5%); }
            50% { transform: translateY(5%); }
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* é›ªèŠ±èƒŒæ™¯åŠ¨ç”» */
        .snowflake {
            position: fixed;
            top: -10px;
            color: #d1fae5;
            font-size: 1em;
            font-family: Arial;
            text-shadow: 0 0 1px #000;
            user-select: none;
            z-index: 0;
            animation-name: snowflakes-fall, snowflakes-shake;
            animation-duration: 10s, 3s;
            animation-timing-function: linear, ease-in-out;
            animation-iteration-count: infinite, infinite;
            animation-play-state: running, running;
        }
        @keyframes snowflakes-fall {
            0% { top: -10%; }
            100% { top: 100%; }
        }
        @keyframes snowflakes-shake {
            0% { transform: translateX(0px); }
            50% { transform: translateX(80px); }
            100% { transform: translateX(0px); }
        }
        .snowflake:nth-of-type(1) { left: 1%; animation-delay: 0s, 0s; }
        .snowflake:nth-of-type(2) { left: 10%; animation-delay: 1s, 1s; }
        .snowflake:nth-of-type(3) { left: 20%; animation-delay: 6s, 0.5s; }
        .snowflake:nth-of-type(4) { left: 30%; animation-delay: 4s, 2s; }
        .snowflake:nth-of-type(5) { left: 40%; animation-delay: 2s, 2s; }
        .snowflake:nth-of-type(6) { left: 50%; animation-delay: 8s, 3s; }
        .snowflake:nth-of-type(7) { left: 60%; animation-delay: 6s, 2s; }
        .snowflake:nth-of-type(8) { left: 70%; animation-delay: 2.5s, 1s; }
        .snowflake:nth-of-type(9) { left: 80%; animation-delay: 1s, 0s; }
        .snowflake:nth-of-type(10) { left: 90%; animation-delay: 3s, 1.5s; }
    </style>
</head>
<body class="bg-red-50 text-gray-800 overflow-hidden">
    <div id="root" class="relative z-10"></div>
    
    <!-- ç®€å•çš„é›ªèŠ±è£…é¥° -->
    <div class="snowflake">â…</div>
    <div class="snowflake">â†</div>
    <div class="snowflake">â…</div>
    <div class="snowflake">â†</div>
    <div class="snowflake">â…</div>
    <div class="snowflake">â†</div>
    <div class="snowflake">â…</div>
    <div class="snowflake">â†</div>
    <div class="snowflake">â…</div>
    <div class="snowflake">â†</div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // å›¾æ ‡ç»„ä»¶
        const Icon = ({ path, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {path}
            </svg>
        );

        const Icons = {
            Gift: (props) => <Icon {...props} path={<><polyline points="20 12 20 22 4 22 4 12"/><rect x="2" y="7" width="20" height="5"/><line x1="12" y1="22" x2="12" y2="7"/><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"/><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"/></>} />,
            Star: (props) => <Icon {...props} path={<polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>} />,
            RotateCcw: (props) => <Icon {...props} path={<><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/></>} />,
            Check: (props) => <Icon {...props} path={<polyline points="20 6 9 17 4 12"/>} />,
            Volume2: (props) => <Icon {...props} path={<><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"/></>} />,
            Tree: (props) => <Icon {...props} path={<><polygon points="12 2 20 10 16 10 20 20 4 20 8 10 4 10 12 2"/><rect x="10" y="20" width="4" height="4"/></>} />
        };

        // -----------------------------------------------------------------------------
        // Unit 8 è¯æ±‡æ•°æ®
        // -----------------------------------------------------------------------------
        const VOCABULARY = [
            { id: 1, en: "Christmas", zh: "åœ£è¯èŠ‚", type: "n.", emoji: "ğŸ„", sentence: "Christmas is coming!" },
            { id: 2, en: "buy", zh: "ä¹°", type: "v.", emoji: "ğŸ›ï¸", sentence: "First, we buy presents." },
            { id: 3, en: "present", zh: "ç¤¼ç‰©", type: "n.", emoji: "ğŸ", sentence: "We put our presents under the tree." },
            { id: 4, en: "Christmas tree", zh: "åœ£è¯æ ‘", type: "n.", emoji: "ğŸ„", sentence: "We buy a Christmas tree." },
            { id: 5, en: "Father Christmas", zh: "åœ£è¯è€äºº", type: "n.", emoji: "ğŸ…", sentence: "We go to see Father Christmas." },
            { id: 6, en: "next", zh: "æ¥ç€ï¼Œç„¶å", type: "adv.", emoji: "ğŸ‘‰", sentence: "Next, we put pretty things on the tree." },
            { id: 7, en: "put", zh: "æ”¾", type: "v.", emoji: "ğŸ‘", sentence: "We put a stocking on our beds." },
            { id: 8, en: "pretty", zh: "æ¼‚äº®çš„", type: "adj.", emoji: "âœ¨", sentence: "We put pretty things on the tree." },
            { id: 9, en: "thing", zh: "ç‰©å“ï¼Œä¸œè¥¿", type: "n.", emoji: "ğŸ§¸", sentence: "Pretty things on the Christmas tree." },
            { id: 10, en: "look", zh: "çœ‹èµ·æ¥", type: "v.", emoji: "ğŸ‘€", sentence: "It looks great!" },
            { id: 11, en: "Christmas Eve", zh: "å¹³å®‰å¤œ", type: "n.", emoji: "ğŸŒ™", sentence: "Then, Christmas Eve comes." },
            { id: 12, en: "stocking", zh: "é•¿ç­’è¢œ", type: "n.", emoji: "ğŸ§¦", sentence: "We put a stocking on our beds." },
            { id: 13, en: "wait for", zh: "ç­‰å€™", type: "v. phr.", emoji: "â³", sentence: "We wait for presents." },
            { id: 14, en: "finally", zh: "æœ€å", type: "adv.", emoji: "ğŸ", sentence: "Finally, it is Christmas Day!" },
            { id: 15, en: "Christmas Day", zh: "åœ£è¯èŠ‚(å½“å¤©)", type: "n.", emoji: "ğŸ“…", sentence: "We wake up early on Christmas Day." },
            { id: 16, en: "early", zh: "æ—©æ—©åœ°", type: "adv.", emoji: "ğŸŒ…", sentence: "We wake up early." },
            { id: 17, en: "turkey", zh: "ç«é¸¡", type: "n.", emoji: "ğŸ¦ƒ", sentence: "We eat a turkey." },
            { id: 18, en: "pudding", zh: "å¸ƒä¸", type: "n.", emoji: "ğŸ®", sentence: "We eat Christmas pudding." },
            { id: 19, en: "all", zh: "å…¨éƒ½", type: "adv.", emoji: "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦", sentence: "We all have a good time!" },
            { id: 20, en: "have a good time", zh: "è¿‡å¾—æ„‰å¿«", type: "v. phr.", emoji: "ğŸ¥³", sentence: "We all have a good time!" },
            { id: 21, en: "card", zh: "å¡ç‰‡", type: "n.", emoji: "ğŸ’Œ", sentence: "First, fold a card." },
            { id: 22, en: "children", zh: "å­©å­ï¼Œå„¿ç«¥", type: "n.", emoji: "ğŸ‘¶", sentence: "Children put a stocking on the beds." },
            { id: 23, en: "message", zh: "ä¿¡æ¯ï¼Œæ¶ˆæ¯", type: "n.", emoji: "ğŸ“", sentence: "Then, write your message." },
            { id: 24, en: "Merry Christmas!", zh: "åœ£è¯å¿«ä¹!", type: "phrase", emoji: "ğŸ‰", sentence: "Merry Christmas!" },
            { id: 25, en: "song", zh: "æ­Œæ›²", type: "n.", emoji: "ğŸµ", sentence: "They sing Christmas songs." },
            { id: 26, en: "What's wrong with...?", zh: "â€¦â€¦æ€ä¹ˆäº†ï¼Ÿ", type: "phrase", emoji: "â“", sentence: "What's wrong with him?" },
            { id: 27, en: "him", zh: "ä»–(å®¾æ ¼)", type: "pron.", emoji: "ğŸ‘¦", sentence: "What's wrong with him?" },
            { id: 28, en: "us", zh: "æˆ‘ä»¬(å®¾æ ¼)", type: "pron.", emoji: "ğŸ‘¥", sentence: "People eat us on Christmas Day!" },
            { id: 29, en: "letter", zh: "ä¿¡", type: "n.", emoji: "âœ‰ï¸", sentence: "I sometimes write him a letter." },
            { id: 30, en: "storybook", zh: "æ•…äº‹ä¹¦", type: "n.", emoji: "ğŸ“–", sentence: "I read a storybook after dinner." },
            { id: 31, en: "after", zh: "åœ¨â€¦â€¦ä»¥å", type: "prep.", emoji: "ğŸ•’", sentence: "I read a storybook after dinner." }
        ];

        function App() {
            const [score, setScore] = useState(0);
            const [currentIndex, setCurrentIndex] = useState(0);
            const [isFlipped, setIsFlipped] = useState(false);
            const [learnedCount, setLearnedCount] = useState(0);
            const [isCompleted, setIsCompleted] = useState(false);
            const [isTransitioning, setIsTransitioning] = useState(false);
            
            // è¯­éŸ³ç›¸å…³
            const [voices, setVoices] = useState([]);
            const [preferredVoice, setPreferredVoice] = useState(null);

            const card = VOCABULARY[currentIndex] || VOCABULARY[0];
            const isLastCard = currentIndex === VOCABULARY.length - 1;

            // åˆå§‹åŒ–åŠ è½½è¯­éŸ³
            useEffect(() => {
                const loadVoices = () => {
                    const availableVoices = window.speechSynthesis.getVoices();
                    setVoices(availableVoices);
                    // ä¼˜å…ˆé€‰æ‹©é«˜è´¨é‡å‘éŸ³
                    const bestVoice = availableVoices.find(v => v.name.includes("Google US English")) ||
                                      availableVoices.find(v => v.name.includes("Microsoft Zira")) ||
                                      availableVoices.find(v => v.name.includes("Samantha")) ||
                                      availableVoices.find(v => v.lang === 'en-US');
                    setPreferredVoice(bestVoice);
                };
                loadVoices();
                if (window.speechSynthesis.onvoiceschanged !== undefined) {
                    window.speechSynthesis.onvoiceschanged = loadVoices;
                }
            }, []);

            // æ’­æ”¾åŠŸèƒ½
            const speak = (text) => {
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.cancel();
                    const utterance = new SpeechSynthesisUtterance(text);
                    if (preferredVoice) utterance.voice = preferredVoice;
                    else utterance.lang = 'en-US';
                    utterance.rate = 0.9; 
                    utterance.pitch = 1.0; 
                    window.speechSynthesis.speak(utterance);
                }
            };

            const handleCardClick = () => {
                if (isTransitioning) return;
                // æ­£é¢ç¿»èƒŒé¢æ—¶æ’­æ”¾
                if (!isFlipped) {
                    speak(card.en);
                }
                setIsFlipped(!isFlipped);
            };

            const nextCard = () => {
                if (isTransitioning) return;
                setIsTransitioning(true);
                setIsFlipped(false);
                setTimeout(() => {
                    if (currentIndex >= VOCABULARY.length - 1) {
                        setIsCompleted(true);
                    } else {
                        setCurrentIndex(prev => prev + 1);
                    }
                    setIsTransitioning(false);
                }, 300);
            };

            const markLearned = () => {
                if (isTransitioning) return;
                setScore(s => s + 10);
                setLearnedCount(c => c + 1);
                nextCard();
            };

            const restartGame = () => {
                setIsCompleted(false);
                setCurrentIndex(0);
                setScore(0);
                setLearnedCount(0);
                setIsFlipped(false);
                setIsTransitioning(false);
            };

            // ç»“ç®—é¡µé¢
            if (isCompleted) {
                return (
                    <div className="min-h-screen bg-red-50 font-sans text-gray-800 flex flex-col items-center justify-center p-4 relative z-10">
                        <div className="bg-white rounded-3xl shadow-xl p-8 max-w-md w-full text-center animate-fade-in border-4 border-red-200">
                            <Icons.Gift className="w-24 h-24 text-red-500 mx-auto mb-6 animate-bounce" />
                            <h2 className="text-3xl font-bold text-red-700 mb-2">Merry Christmas!</h2>
                            <p className="text-gray-500 mb-8">Unit 8 æŒ‘æˆ˜å®Œæˆ</p>
                            
                            <div className="bg-green-50 rounded-xl p-6 mb-8 border border-green-100">
                                <div className="grid grid-cols-2 gap-4">
                                    <div className="text-center border-r border-green-200">
                                        <p className="text-sm text-gray-500 mb-1">æ€»å¾—åˆ† XP</p>
                                        <p className="text-3xl font-bold text-green-600">{score}</p>
                                    </div>
                                    <div className="text-center">
                                        <p className="text-sm text-gray-500 mb-1">æŒæ¡å•è¯</p>
                                        <p className="text-3xl font-bold text-red-500">{learnedCount} <span className="text-sm text-gray-400">/ {VOCABULARY.length}</span></p>
                                    </div>
                                </div>
                            </div>

                            <button 
                                onClick={restartGame}
                                className="w-full py-4 rounded-2xl bg-red-600 text-white font-bold text-lg shadow-lg hover:bg-red-700 hover:shadow-xl transition flex items-center justify-center space-x-2"
                            >
                                <Icons.RotateCcw className="w-6 h-6" />
                                <span>å†ç©ä¸€æ¬¡</span>
                            </button>
                        </div>
                    </div>
                );
            }

            // ä¸»é¡µé¢
            return (
                <div className="min-h-screen font-sans text-gray-800 flex flex-col items-center relative z-10">
                    
                    {/* Header */}
                    <header className="w-full bg-red-600 text-white p-4 shadow-md flex justify-between items-center sticky top-0 z-20">
                        <div className="flex items-center space-x-2">
                            <Icons.Tree className="w-6 h-6 text-green-300" />
                            <h1 className="text-lg font-bold">Unit 8 At Christmas</h1>
                        </div>
                        <div className="flex items-center space-x-4">
                            <div className="text-sm opacity-90 hidden sm:block">
                                {currentIndex + 1} / {VOCABULARY.length}
                            </div>
                            <div className="bg-red-800 px-3 py-1 rounded-full flex items-center space-x-1 border border-red-700">
                                <Icons.Star className="w-4 h-4 text-yellow-400 fill-current" />
                                <span className="font-bold">{score}</span>
                            </div>
                        </div>
                    </header>

                    <main className="flex-1 w-full max-w-md p-6 flex flex-col items-center justify-center animate-fade-in">
                        
                        {/* è¿›åº¦æ¡ */}
                        <div className="w-full bg-gray-200 h-2 rounded-full mb-8 overflow-hidden">
                            <div 
                                className="bg-green-500 h-2 rounded-full transition-all duration-500"
                                style={{ width: `${((currentIndex) / VOCABULARY.length) * 100}%` }}
                            ></div>
                        </div>

                        {/* å¡ç‰‡å®¹å™¨ */}
                        <div 
                            className={`relative w-full aspect-[3/4] max-h-[500px] perspective-1000 select-none ${isTransitioning ? 'cursor-wait' : 'cursor-pointer group'}`}
                            onClick={handleCardClick}
                        >
                            <div className={`relative w-full h-full duration-500 transform-style-3d transition-transform ${isFlipped ? 'my-rotate-y-180' : ''}`}>
                                
                                {/* æ­£é¢ (Front): ä¸­æ–‡ + Emoji */}
                                <div className="absolute w-full h-full bg-white rounded-3xl shadow-xl border-4 border-red-100 flex flex-col items-center justify-center backface-hidden p-6 text-center z-10">
                                    <span className="text-8xl mb-6 animate-bounce-slow filter drop-shadow-md">{card.emoji}</span>
                                    <h3 className="text-5xl font-bold text-gray-800 tracking-wider mb-2">{card.zh}</h3>
                                    {/* è¯æ€§æ˜¾ç¤º */}
                                    <p className="text-gray-400 text-sm font-medium mb-6 italic">{card.type}</p>
                                    <p className="text-red-400 mt-2 text-sm font-medium bg-red-50 px-4 py-2 rounded-full border border-red-100">
                                        ç‚¹å‡»æŸ¥çœ‹è‹±æ–‡
                                    </p>
                                </div>

                                {/* èƒŒé¢ (Back): è‹±æ–‡ + ä¾‹å¥ */}
                                <div className="absolute w-full h-full bg-red-600 text-white rounded-3xl shadow-xl flex flex-col items-center justify-center backface-hidden my-rotate-y-180 p-6 text-center border-4 border-green-400 relative">
                                    {/* æ’­æ”¾æŒ‰é’® */}
                                    <button 
                                        onClick={(e) => { e.stopPropagation(); speak(card.en); }}
                                        className="absolute top-4 right-4 p-3 bg-white/20 hover:bg-white/30 rounded-full transition backdrop-blur-sm z-20"
                                    >
                                        <Icons.Volume2 className="w-6 h-6 text-white" />
                                    </button>

                                    <h3 className="text-4xl font-bold mb-6 text-yellow-300 tracking-tight break-words w-full">{card.en}</h3>
                                    <div className="w-16 h-1 bg-white/30 rounded-full mb-8"></div>
                                    <div className="bg-red-700/50 p-6 rounded-xl w-full border border-red-500">
                                        <p className="text-lg leading-relaxed font-medium">"{card.sentence}"</p>
                                    </div>
                                    <p className="mt-8 text-red-200 text-sm">å†ç‚¹ä¸€ä¸‹ç¿»å›å»</p>
                                </div>
                            </div>
                        </div>

                        {/* æŒ‰é’®åŒº */}
                        <div className="flex items-center justify-between w-full mt-10 space-x-4">
                            <button 
                                onClick={nextCard}
                                disabled={isTransitioning}
                                className={`flex-1 py-4 rounded-2xl bg-white text-gray-600 font-bold border-2 border-gray-100 transition flex items-center justify-center space-x-2 ${isTransitioning ? 'opacity-50' : 'hover:bg-gray-50 hover:border-gray-300'}`}
                            >
                                <Icons.RotateCcw className="w-5 h-5" />
                                <span>{isLastCard ? "ç»“æŸ" : "è·³è¿‡"}</span>
                            </button>
                            
                            <button 
                                onClick={markLearned}
                                disabled={isTransitioning}
                                className={`flex-[2] py-4 rounded-2xl bg-green-500 text-white font-bold shadow-lg transition-all flex items-center justify-center space-x-2 ${isTransitioning ? 'opacity-50' : 'hover:bg-green-600 hover:shadow-xl hover:-translate-y-1'}`}
                            >
                                <Icons.Check className="w-6 h-6" />
                                <span>{isLastCard ? "å®Œæˆ (+10)" : "æˆ‘è®°ä½äº†"}</span>
                            </button>
                        </div>
                    </main>

                    <footer className="p-4 text-center text-red-300 text-xs">
                        Grade 5 English â€¢ Unit 8 At Christmas
                    </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
